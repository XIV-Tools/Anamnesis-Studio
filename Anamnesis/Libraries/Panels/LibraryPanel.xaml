<panels:PanelBase
	x:Class="Anamnesis.Libraries.Panels.LibraryPanel"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:XivToolsWpf="clr-namespace:XivToolsWpf.Controls;assembly=XivToolsWpf"
	xmlns:controls="clr-namespace:Anamnesis.Controls"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:libraryItems="clr-namespace:Anamnesis.Libraries.Items"
	xmlns:local="clr-namespace:Anamnesis.Libraries.Panels"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:panels="clr-namespace:Anamnesis.Panels"
	xmlns:vwp="clr-namespace:WpfToolkit.Controls;assembly=VirtualizingWrapPanel"
	Width="800"
	Height="450"
	CanResize="True"
	Icon="Book"
	TitleKey="Naviagation_Library"
	mc:Ignorable="d">
	<Grid x:Name="ContentArea">
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="200" />
			<ColumnDefinition Width="250" />
			<ColumnDefinition />
		</Grid.ColumnDefinitions>

		<!--  packs  -->
		<ListBox
			Grid.Column="0"
			ItemsSource="{Binding Services.Library.Packs}"
			SelectedItem="{Binding SelectedPack}"
			SelectionChanged="OnPackSelectionChanged">

			<ListBox.ItemContainerStyle>
				<Style TargetType="{x:Type ListBoxItem}">

					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate TargetType="{x:Type ListBoxItem}">
								<ToggleButton
									Height="42"
									HorizontalContentAlignment="Stretch"
									IsChecked="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}, Path=IsSelected}"
									Style="{StaticResource TransparentIconToggleButton}">

									<Grid Margin="0,3">
										<Grid.RowDefinitions>
											<RowDefinition />
											<RowDefinition Height="Auto" />
										</Grid.RowDefinitions>

										<Grid.ToolTip>
											<XivToolsWpf:TextBlock Text="{Binding Source.Name}" />
										</Grid.ToolTip>

										<XivToolsWpf:TextBlock
											Grid.Row="0"
											Text="{Binding Name}"
											TextTrimming="CharacterEllipsis" />

										<XivToolsWpf:TextBlock
											Grid.Row="1"
											FontSize="10"
											Opacity="0.75"
											Text="{Binding Author}" />

										<XivToolsWpf:TextBlock
											Key="Library_ItemCount"
											Grid.Row="1"
											HorizontalAlignment="Right"
											FontSize="10"
											Opacity="0.75"
											Value="{Binding ItemCount}" />

										<Grid
											Grid.RowSpan="2"
											HorizontalAlignment="Right"
											VerticalAlignment="Top"
											Background="Transparent">

											<Grid.ToolTip>
												<XivToolsWpf:TextBlock Text="{Binding Source.Name}" />
											</Grid.ToolTip>

											<XivToolsWpf:IconBlock
												Margin="3"
												Icon="{Binding Source.Icon}" />
										</Grid>
									</Grid>

								</ToggleButton>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</Style>
			</ListBox.ItemContainerStyle>
		</ListBox>

		<Grid
			Grid.Column="1"
			Visibility="{Binding SelectedPack, Converter={StaticResource NotNullToVisibilityConverter}}">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto" />
				<RowDefinition Height="Auto" />
				<RowDefinition />
			</Grid.RowDefinitions>

			<Border
				Grid.Row="0"
				Height="138"
				Margin="3"
				Style="{StaticResource InsetPanel}">

				<Border.Background>
					<ImageBrush
						ImageSource="{Binding SelectedPack.HeaderImage}"
						Stretch="Uniform" />
				</Border.Background>
			</Border>

			<Border
				Grid.Row="1"
				Grid.Column="1"
				Margin="3"
				Style="{StaticResource InsetPanel}">

				<Grid
					Margin="6"
					VerticalAlignment="Top">

					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>

					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="Auto" />
						<ColumnDefinition />
					</Grid.ColumnDefinitions>

					<XivToolsWpf:TextBlock
						Grid.Row="0"
						Grid.ColumnSpan="3"
						Style="{StaticResource Header}"
						Text="{Binding SelectedPack.Name}" />

					<XivToolsWpf:TextBlock
						Grid.Row="1"
						Grid.ColumnSpan="2"
						Margin="10,0,0,12"
						Text="{Binding SelectedPack.Description}"
						TextWrapping="Wrap"
						Visibility="{Binding SelectedPack.Description, Converter={StaticResource NotNullToVisibilityConverter}}" />


					<XivToolsWpf:TextBlock
						Key="FileMeta_Author"
						Grid.Row="2"
						Grid.Column="0"
						Margin="0,0,6,0"
						Style="{StaticResource Label}" />
					<XivToolsWpf:TextBlock
						Grid.Row="2"
						Grid.Column="1"
						Text="{Binding SelectedPack.Author}" />

					<XivToolsWpf:TextBlock
						Key="FileMeta_Version"
						Grid.Row="3"
						Grid.Column="0"
						Margin="0,0,6,0"
						Style="{StaticResource Label}"
						Visibility="{Binding SelectedPack.Version, Converter={StaticResource NotNullToVisibilityConverter}}" />
					<XivToolsWpf:TextBlock
						Grid.Row="3"
						Grid.Column="1"
						Text="{Binding SelectedPack.Version}"
						Visibility="{Binding SelectedPack.Version, Converter={StaticResource NotNullToVisibilityConverter}}" />

					<XivToolsWpf:TextBlock
						Key="Library_Source"
						Grid.Row="4"
						Grid.Column="0"
						Margin="0,0,6,0"
						Style="{StaticResource Label}" />

					<Grid
						Grid.Row="4"
						Grid.Column="1">

						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition />
						</Grid.ColumnDefinitions>

						<XivToolsWpf:IconBlock
							Grid.Column="0"
							Margin="0,0,3,0"
							Icon="{Binding SelectedPack.Source.Icon}" />
						<XivToolsWpf:TextBlock
							Grid.Column="1"
							Text="{Binding SelectedPack.Source.Name}"
							TextTrimming="CharacterEllipsis" />
					</Grid>

					<XivToolsWpf:TextBlock
						Key="Library_Items"
						Grid.Row="5"
						Grid.Column="0"
						Margin="0,0,6,0"
						Style="{StaticResource Label}" />

					<XivToolsWpf:TextBlock
						Grid.Row="5"
						Grid.Column="1"
						Margin="0,0,6,0"
						Text="{Binding SelectedPack.ItemCount, StringFormat='{}{0:n0}'}" />

					<Grid
						Grid.Row="6"
						Grid.ColumnSpan="2"
						Margin="0,6,0,0">

						<Button
							Width="28"
							Height="28"
							HorizontalAlignment="Left"
							Click="OnPackRefreshClicked"
							Style="{StaticResource TransparentIconButton}">
							<XivToolsWpf:IconBlock Icon="Refresh" />
						</Button>

						<Button
							Height="26"
							Margin="3,0,0,0"
							HorizontalAlignment="Right"
							Click="OnPackUpdateClicked"
							IsEnabled="{Binding SelectedPack.IsUpdating, Converter={StaticResource !B}}"
							Style="{StaticResource TransparentButton}"
							Visibility="{Binding SelectedPack.IsUpdateAvailable, Converter={StaticResource B2V}}">

							<Grid>
								<Grid
									Margin="6,0"
									Visibility="{Binding SelectedPack.IsUpdating, Converter={StaticResource !B2V}}">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition />
									</Grid.ColumnDefinitions>

									<XivToolsWpf:IconBlock
										Grid.Column="0"
										Margin="3"
										Icon="Download" />
									<XivToolsWpf:TextBlock
										Grid.Column="1"
										Margin="3"
										Text="Update Available" />
								</Grid>

								<Grid
									Margin="6,0"
									Visibility="{Binding SelectedPack.IsUpdating, Converter={StaticResource B2V}}">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="Auto" />
										<ColumnDefinition />
									</Grid.ColumnDefinitions>

									<ProgressBar
										Grid.Column="0"
										IsIndeterminate="True"
										Style="{StaticResource MaterialDesignCircularProgressBar}" />

									<XivToolsWpf:TextBlock
										Grid.Column="1"
										Margin="3"
										Text="Updating" />
								</Grid>
							</Grid>

						</Button>
					</Grid>

				</Grid>
			</Border>

			<Grid Grid.Row="2">

				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition />
				</Grid.RowDefinitions>

				<TextBox
					Grid.Row="0"
					Margin="6,0"
					Style="{StaticResource MaterialDesignTextBox}" />

				<ItemsControl
					Grid.Row="1"
					Margin="6"
					ItemsSource="{Binding FilterByTags}">
					<ItemsControl.ItemsPanel>
						<ItemsPanelTemplate>
							<WrapPanel />
						</ItemsPanelTemplate>
					</ItemsControl.ItemsPanel>
					<ItemsControl.ItemTemplate>
						<DataTemplate>
							<ToggleButton
								Margin="3"
								IsChecked="{Binding IsEnabled}"
								IsEnabled="{Binding IsAvailable}">
								<ToggleButton.Style>
									<Style TargetType="{x:Type ToggleButton}">
										<Setter Property="Foreground" Value="{StaticResource MaterialDesignBody}" />

										<Setter Property="Template">
											<Setter.Value>
												<ControlTemplate TargetType="{x:Type ToggleButton}">
													<Grid>
														<Border
															x:Name="Border"
															Background="{StaticResource MaterialDesignPaper}"
															CornerRadius="10" />

														<Grid
															x:Name="ContentGrid"
															Margin="3,-2">
															<Grid.ColumnDefinitions>
																<ColumnDefinition Width="Auto" />
																<ColumnDefinition />
															</Grid.ColumnDefinitions>

															<XivToolsWpf:IconBlock
																x:Name="TagIcon"
																Grid.Column="0"
																Margin="2,2,2,0"
																Foreground="{StaticResource MaterialDesignBodyLight}"
																Icon="Tag"
																Opacity="0.5" />

															<ContentPresenter
																Grid.Column="1"
																Content="{TemplateBinding Content}" />

														</Grid>
													</Grid>

													<ControlTemplate.Triggers>
														<Trigger Property="IsChecked" Value="False">
															<Setter TargetName="TagIcon" Property="Foreground" Value="{StaticResource MaterialDesignBody}" />
															<Setter TargetName="ContentGrid" Property="Opacity" Value="0.5" />
															<Setter TargetName="Border" Property="Background" Value="Black" />
															<Setter TargetName="Border" Property="Opacity" Value="0.25" />
														</Trigger>
														<Trigger Property="IsEnabled" Value="False">
															<Setter TargetName="TagIcon" Property="Foreground" Value="{StaticResource MaterialDesignTextFieldBoxDisabledBackground}" />
															<Setter Property="Foreground" Value="{StaticResource MaterialDesignTextFieldBoxDisabledBackground}" />
															<Setter TargetName="Border" Property="Opacity" Value="0" />
														</Trigger>
													</ControlTemplate.Triggers>
												</ControlTemplate>
											</Setter.Value>
										</Setter>
									</Style>
								</ToggleButton.Style>

								<XivToolsWpf:TextBlock
									MaxWidth="100"
									Margin="4"
									Text="{Binding Name}"
									TextTrimming="CharacterEllipsis" />
							</ToggleButton>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>

				<XivToolsWpf:TextBlock
					Key="Library_FilteredItemCount"
					Grid.Row="2"
					VerticalAlignment="Top"
					Style="{StaticResource Label}"
					Value="{Binding Items.Count}" />

			</Grid>
		</Grid>

		<ListBox
			Grid.Column="2"
			Background="Transparent"
			ItemsSource="{Binding Items, IsAsync=True}">
			<ListBox.ItemsPanel>
				<ItemsPanelTemplate>
					<vwp:VirtualizingWrapPanel IsItemsHost="True" />
				</ItemsPanelTemplate>
			</ListBox.ItemsPanel>

			<ListBox.ItemTemplate>
				<DataTemplate>
					<Grid
						Width="92"
						Height="128">

						<Grid.RowDefinitions>
							<RowDefinition Height="96" />
							<RowDefinition Height="32" />
						</Grid.RowDefinitions>

						<XivToolsWpf:IconBlock
							FontSize="90"
							Icon="File"
							Visibility="{Binding Icon, Converter={StaticResource NullToVisibilityConverter}}" />

						<Image
							Margin="6"
							Source="{Binding Icon}"
							Visibility="{Binding Icon, Converter={StaticResource NotNullToVisibilityConverter}}" />

						<XivToolsWpf:TextBlock
							Grid.Row="1"
							VerticalAlignment="Top"
							Text="{Binding Name}"
							TextAlignment="Center"
							TextWrapping="Wrap" />
					</Grid>
				</DataTemplate>
			</ListBox.ItemTemplate>
		</ListBox>

	</Grid>
</panels:PanelBase>
